<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div>
      <div class="gradient-top-left"></div>
      <div class="gradient-top-right"></div>
      <div class="gradient-bottom-left"></div>
    </div>
    <main class="navbar-container">
      <nav>
        <div class="flex items-center">
          <img class="avatar" src="{{avatar}}" alt="{{username}}'s avatar" />
        </div>
        <div>
          <h1 class="nav-text">INTERRUPTED</h1>
        </div>
        <div class="logout">
          <h1 id="logout" class="nav-text">Logout</h1>
        </div>
      </nav>
    </main>
    <main class="main-content">
      <div id="dashboard-content" class="upload-container dashboard">
        <div class="upload-contents">
          <div class="user-info">
            <h2>Welcome back {{username}}!</h2>
            <p>Upload your files here</p>
          </div>
          <div class="upload">
            <div>
              <button id="select-file">Select file</button>
            </div>
            <div>
              <button id="capture-screenshot">Capture screenshot</button>
            </div>
          </div>
        </div>
      </div>
      <div id="gallery-content" class="upload-container gallery">
        <div class="gallery-contents">
          <h1>gallery</h1>
          <div class="images"></div>
        </div>
      </div>
    </main>
    <script>
      const logout = document.getElementById("logout");
      logout.addEventListener("click", () => {
        window.logOut();
      });

      const selectFile = document.getElementById("select-file");
      selectFile.addEventListener("click", () => {
        window.selectFile().then((response) => {
          alert(response);
        });
      });

      const captureButton = document.getElementById("capture-screenshot");
      captureButton.addEventListener("click", () => {
        monitor = prompt(
          "Enter the monitor number to capture screenshot (Primary is usually 0)",
          0
        );

        if (monitor === null || isNaN(monitor)) {
          alert("Invalid monitor number");
          return;
        }
        window.captureScreenshot(monitor).then((response) => {
          alert(response);
        });
      });

      document.addEventListener("DOMContentLoaded", (event) => {
        window.fetchGallery().then((response) => {
          if (response.length > 0) {
            const imagesContainer = document.querySelector(".images");

            response.forEach((image) => {
              const img = document.createElement("img");
              img.src = image.url;

              img.setAttribute("data-url", image.url);

              img.addEventListener("click", (event) => {
                const clickedImageUrl = event.target.getAttribute("data-url");
                window.copyToClipboard(clickedImageUrl).then((response) => {
                  alert(response);
                });
              });

              imagesContainer.appendChild(img);
            });
          }
        });
      });
    </script>
  </body>
</html>
