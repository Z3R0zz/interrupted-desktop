<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div>
      <div class="gradient-top-left"></div>
      <div class="gradient-top-right"></div>
      <div class="gradient-bottom-left"></div>
    </div>
    <main class="navbar-container">
      <nav>
        <div class="flex items-center">
          <img class="avatar" src="{{avatar}}" alt="{{username}}'s avatar" />
        </div>
        <div>
          <h1 class="nav-text">INTERRUPTED</h1>
        </div>
        <div class="logout">
          <h1 id="logout" class="nav-text">Logout</h1>
        </div>
      </nav>
    </main>
    <main class="main-content">
      <div id="dashboard-content" class="upload-container dashboard">
        <div class="upload-contents">
          <div class="user-info">
            <h2>Welcome back {{username}}!</h2>
            <p>Upload your files here</p>
          </div>
          <div class="upload">
            <div>
              <button id="select-file">Select file</button>
            </div>
            <div>
              <button id="capture-screenshot">Capture screenshot</button>
            </div>
          </div>
          <div id="monitor-list"></div>
        </div>
      </div>
      <div id="gallery-content" class="upload-container gallery">
        <div class="gallery-contents">
          <h1>gallery</h1>
          <div class="images"></div>
        </div>
      </div>
    </main>
    <script>
      const logout = document.getElementById("logout");
      logout.addEventListener("click", () => {
        window.logOut();
      });

      const selectFile = document.getElementById("select-file");
      selectFile.addEventListener("click", () => {
        window.selectFile().then((response) => {
          alert(response);
          updateGallery();
        });
      });

      document
        .getElementById("capture-screenshot")
        .addEventListener("click", () => {
          window.fetchMonitors().then((monitors) => {
            const monitorList = document.getElementById("monitor-list");
            monitorList.innerHTML = "";

            if (monitors.length === 0) {
              alert("No monitors found!");
              return;
            }

            monitors.forEach((monitor, index) => {
              const monitorDiv = document.createElement("div");
              monitorDiv.innerHTML = `
        <p>Monitor ${index}: ${monitor.width}x${monitor.height}</p>
        <button onclick="screenshot(${index})">Capture Screenshot</button>
      `;
              monitorList.appendChild(monitorDiv);
            });
          });
        });

      function screenshot(monitorIndex) {
        window.captureScreenshot(monitorIndex).then((response) => {
          alert(response);
          updateGallery();
        });
      }

      document.addEventListener("DOMContentLoaded", (event) => {
        window.fetchGallery().then((response) => {
          if (response.length > 0) {
            const imagesContainer = document.querySelector(".images");

            response.forEach((image) => {
              const img = document.createElement("img");
              img.src = image.url;

              img.setAttribute("data-url", image.url);

              img.addEventListener("click", (event) => {
                const clickedImageUrl = event.target.getAttribute("data-url");
                window.copyToClipboard(clickedImageUrl).then((response) => {
                  alert(response);
                });
              });

              imagesContainer.appendChild(img);
            });
          }
        });
      });

      function updateGallery() {
        window.fetchGallery().then((response) => {
          const imagesContainer = document.querySelector(".images");
          imagesContainer.innerHTML = "";

          response.forEach((image) => {
            const img = document.createElement("img");
            img.src = image.url;

            img.setAttribute("data-url", image.url);

            img.addEventListener("click", (event) => {
              const clickedImageUrl = event.target.getAttribute("data-url");
              window.copyToClipboard(clickedImageUrl).then((response) => {
                alert(response);
              });
            });

            imagesContainer.appendChild(img);
          });
        });
      }
    </script>
  </body>
</html>
